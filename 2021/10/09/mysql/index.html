<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="JSt260h9ZipxDe9fDWuLLwbMKW6KZ1gPsQ2V68XJlTA">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"aoif-hikari.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="MySQL，最流行的关系型数据库管理系统。">
<meta property="og:type" content="article">
<meta property="og:title" content="数据库 &#x2F; MySQL">
<meta property="og:url" content="https://aoif-hikari.github.io/2021/10/09/mysql/index.html">
<meta property="og:site_name" content="心臓から花が咲くように">
<meta property="og:description" content="MySQL，最流行的关系型数据库管理系统。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://notes.sjtu.edu.cn/uploads/upload_706e769f8dbc49a66417d8e29879ebba.png">
<meta property="article:published_time" content="2021-10-08T16:00:00.000Z">
<meta property="article:modified_time" content="2021-12-10T04:36:55.280Z">
<meta property="article:author" content="aoif.hikari">
<meta property="article:tag" content="数据库">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://notes.sjtu.edu.cn/uploads/upload_706e769f8dbc49a66417d8e29879ebba.png">

<link rel="canonical" href="https://aoif-hikari.github.io/2021/10/09/mysql/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>数据库 / MySQL | 心臓から花が咲くように</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="心臓から花が咲くように" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">心臓から花が咲くように</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://aoif-hikari.github.io/2021/10/09/mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat.jpg">
      <meta itemprop="name" content="aoif.hikari">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="心臓から花が咲くように">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          数据库 / MySQL
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-10-09 00:00:00" itemprop="dateCreated datePublished" datetime="2021-10-09T00:00:00+08:00">2021-10-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-12-10 12:36:55" itemprop="dateModified" datetime="2021-12-10T12:36:55+08:00">2021-12-10</time>
              </span>

          
            <span id="/2021/10/09/mysql/" class="post-meta-item leancloud_visitors" data-flag-title="数据库 / MySQL" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/10/09/mysql/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/10/09/mysql/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              <span>9.4k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              <span>9 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>MySQL，最流行的关系型数据库管理系统。</p>
</blockquote>
<span id="more"></span>
<h2 id="数据库基本操作"><a href="#数据库基本操作" class="headerlink" title="数据库基本操作"></a>数据库基本操作</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">show database;  #查看现有的数据库</span><br><span class="line">create database bjpowernode; #创建数据库</span><br><span class="line">use bjpowernode;  #指定当前缺省数据库</span><br><span class="line">select database;  #查看当前使用的库</span><br><span class="line">drop database bjpowernode; #删除数据库</span><br></pre></td></tr></table></figure>
<h2 id="数据表基本操作"><a href="#数据表基本操作" class="headerlink" title="数据表基本操作"></a>数据表基本操作</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">show tables;  #查看当前库中的表</span><br><span class="line">show tables from &lt;database name&gt;;  #查看其他库中的表</span><br><span class="line">desc &lt;table name&gt;;  #查看表的结构</span><br><span class="line"></span><br><span class="line">#创建表,create table,表名在数据库当中一般建议以t_或者tbl_开始。</span><br><span class="line">create table t_student(</span><br><span class="line">    no bigint,</span><br><span class="line">    name varchar(255),</span><br><span class="line">    sex char(1),</span><br><span class="line">    classno varchar(255),</span><br><span class="line">    birth char(10)</span><br><span class="line">);</span><br><span class="line"># 将查询结果当做表创建出来。		</span><br><span class="line">create table 表名 as select语句;</span><br><span class="line">		</span><br><span class="line">#删除数据表 DROP TABLE		</span><br><span class="line">DROP TABLE if exists t_student; </span><br><span class="line"></span><br><span class="line">#插入数据 insert into</span><br><span class="line">insert into t_student</span><br><span class="line">	(no,name,sex,classno,birth) </span><br><span class="line">values</span><br><span class="line">	(3,&#x27;rose&#x27;,&#x27;1&#x27;,&#x27;gaosi2ban&#x27;,&#x27;1952-12-14&#x27;),</span><br><span class="line">	(4,&#x27;laotie&#x27;,&#x27;1&#x27;,&#x27;gaosi2ban&#x27;,&#x27;1955-12-14&#x27;);</span><br><span class="line"># 除name字段之外，剩下的所有字段自动插入NULL	</span><br><span class="line">insert into t_student(name) values(&#x27;wangwu&#x27;); </span><br><span class="line"># 字段可以省略不写，但是后面的value对数量和顺序都有要求。</span><br><span class="line">insert into t_student values(1,&#x27;jack&#x27;,&#x27;0&#x27;,&#x27;gaosan2ban&#x27;,&#x27;1986-10-23&#x27;);</span><br><span class="line"># 将查询结果插入到一张表中</span><br><span class="line">insert into dept1 select...</span><br><span class="line"></span><br><span class="line">#修改数据，update...set...，没有条件整张表数据全部更新。</span><br><span class="line">update 表名 set 字段名1=值1,字段名2=值2... where 条件;</span><br><span class="line">update dept1 set loc = &#x27;SHANGHAI&#x27;, dname = &#x27;RENSHIBU&#x27; where deptno = 10;</span><br><span class="line"></span><br><span class="line">#删除数据，delete from，没有条件全部删除。</span><br><span class="line">delete from 表名;</span><br><span class="line">delete from 表名 where 条件;</span><br><span class="line">delete from dept1 where deptno = 10;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>MySQL当中字段的常见数据类型：<br>        int        整数型(java中的int)<br>        bigint    长整型(java中的long)<br>        float        浮点型(java中的float double)<br>        char        定长字符串(String)<br>        varchar    可变长字符串(StringBuffer/StringBuilder)<br>        date        日期类型 （对应Java中的java.sql.Date类型）<br>        BLOB        二进制大对象（存储图片、视频等流媒体信息） Binary Large OBject （对应java中的Object）<br>        CLOB        字符大对象（存储较大文本，比如，可以存储4G的字符串。） Character Large OBject（对应java中的Object）</p>
<p>char和varchar？<br>当某个字段中的数据长度不发生改变的时候，是定长的，例如：性别、生日等采用char。当一个字段的数据长度不确定，例如：简介、姓名等用varchar。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#查</span><br><span class="line"></span><br><span class="line">	select		5</span><br><span class="line">		...</span><br><span class="line">	from			1</span><br><span class="line">		...		</span><br><span class="line">	where			2</span><br><span class="line">		...	</span><br><span class="line">	group by		3</span><br><span class="line">		...</span><br><span class="line">	having		4</span><br><span class="line">		...</span><br><span class="line">	order by		6</span><br><span class="line">		...</span><br><span class="line">	limit			7</span><br><span class="line">		...;</span><br><span class="line"></span><br><span class="line">select empno, ename from emp;</span><br><span class="line">select * from emp;</span><br><span class="line">select empno, ename, sal*12 from emp; #select语句中可以使用运算符</span><br><span class="line">select empno as ‘员工编号’, ename as ‘员工姓名’, sal*12 as ‘年薪’ from emp;</span><br><span class="line">SELECT * from runoob_tbl  WHERE runoob_author LIKE &#x27;%COM&#x27;; # LIKE 子句中使用 % 字符来表示任意字符,类似正则表达式中 *</span><br><span class="line">select distinct deptno,job from emp; # distinct关键字去除重复记录。distinct只能出现在所有字段的最前面。</span><br><span class="line"></span><br><span class="line">#条件查询where</span><br><span class="line">select empno, ename, sal from emp where sal=5000;</span><br><span class="line">select empno, ename from emp where job=&quot;manager&quot;; #字符串加&quot; &quot;或&#x27; &#x27;,不区分大小写</span><br><span class="line"></span><br><span class="line">#排序，系统默认由小到大 order by</span><br><span class="line">select * from emp order by sal;</span><br><span class="line">select * from emp order by job,sal; #按照多个字段排序，首先按照job排序，再按照sal排序</span><br><span class="line">select * from emp order by sal asc/desc; #小到大/大到小</span><br><span class="line"></span><br><span class="line">#union，将查询结果集相加</span><br><span class="line">select ename,job from emp where job = &#x27;MANAGER&#x27;</span><br><span class="line">union</span><br><span class="line">select ename,job from emp where job = &#x27;SALESMAN&#x27;;</span><br><span class="line"></span><br><span class="line">#分组,对分组之后的数据进行再次过滤 group by...having...</span><br><span class="line">#分组函数/多行处理函数/聚合函数，count sum avg max min</span><br><span class="line">#分组函数不可直接使用在where子句当中,在group by语句执行结束之后才会执行,一般用在select子句中</span><br><span class="line"># 当一条语句中有group by的话，select后面只能跟分组函数和参与分组的字段。</span><br><span class="line"></span><br><span class="line">#连接查询</span><br><span class="line">#语法：</span><br><span class="line">		...</span><br><span class="line">			A</span><br><span class="line">		join</span><br><span class="line">			B</span><br><span class="line">		on</span><br><span class="line">			连接条件</span><br><span class="line">		where</span><br><span class="line">			...</span><br><span class="line"># limit startIndex, length,分页查询,取结果集中的部分数据,从0开始，0表示第一条数据</span><br><span class="line">#取出工资前5名的员工</span><br><span class="line">select ename,sal from emp order by sal desc limit 0, 5;</span><br><span class="line">select ename,sal from emp order by sal desc limit 5;</span><br><span class="line">#找出工资排名在第4到第9名的员工</span><br><span class="line">select ename,sal from emp order by sal desc limit 3,6;</span><br><span class="line">#通用的标准分页sql,每页显示3条记录,pageSize = 3,pageNo是显示第几页</span><br><span class="line">limit (pageNo - 1) * pageSize, pageSize</span><br></pre></td></tr></table></figure>
<h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><blockquote>
<p>笛卡尔积现象，也称交叉连接。返回左表中的每一行与右表中的所有行组合。</p>
</blockquote>
<h3 id="内连接（等值连接）"><a href="#内连接（等值连接）" class="headerlink" title="内连接（等值连接）"></a>内连接（等值连接）</h3><p>组合两个表中的记录，返回关联字段相符的记录，也就是返回两个表的交集部分。<strong>显示部分数据</strong>。</p>
<h3 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h3><p>以主表为基准(将主表的数据全部显示)，从表显示与主表对应的数据，如果对应的没有，则以null补齐。即<strong>结果全部显示</strong>。</p>
<h4 id="左"><a href="#左" class="headerlink" title="左"></a>左</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT * </span><br><span class="line">FROM a_table a </span><br><span class="line">left join b_table b # 左的左是左表</span><br><span class="line">ON a.a_id = b.b_id;</span><br></pre></td></tr></table></figure>
<p>左表（主）(a_table)的记录将会全部表示出来，而右表(b_table)只会显示符合搜索条件的记录。右表记录不足的地方均为NULL。</p>
<h4 id="右"><a href="#右" class="headerlink" title="右"></a>右</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT * </span><br><span class="line">FROM a_table a </span><br><span class="line">right outer join b_table b # 右的右是右表</span><br><span class="line">on a.a_id = b.b_id;</span><br></pre></td></tr></table></figure>
<p>右表（主）(b_table)的记录将会全部表示出来,左表(a_table)只会显示符合搜索条件的记录。左表记录不足的地方均为NULL。</p>
<h4 id="全连接"><a href="#全连接" class="headerlink" title="全连接"></a>全连接</h4><p>全连接=左连接+右连接，<code>full join</code></p>
<h2 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h2><p>非空约束(not null)：约束的字段不能为NULL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table t_user(</span><br><span class="line">    id int,</span><br><span class="line">    username varchar(255) not null,</span><br><span class="line">    password varchar(255)</span><br><span class="line">);</span><br><span class="line"># not null约束只有列级约束。没有表级约束。</span><br></pre></td></tr></table></figure>
<p>唯一约束(unique)：约束的字段不能重复，可以为NULL。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create table t_user(</span><br><span class="line">    id int,</span><br><span class="line">    username varchar(255) unique # 列级约束</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table t_user(</span><br><span class="line">    id int, </span><br><span class="line">    usercode varchar(255),</span><br><span class="line">    username varchar(255),</span><br><span class="line">    unique(usercode,username) # 多个字段联合起来添加1个约束unique 【表级约束】</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="主键约束-primary-key"><a href="#主键约束-primary-key" class="headerlink" title="主键约束(primary key)"></a>主键约束(primary key)</h3><p>主键值是这行记录在这张表当中的唯一标识。约束的字段<strong>既不能为NULL，也不能重复</strong>（简称PK）。一张表的主键约束只能有1个。第一范式要求任何一张表都应该有主键。</p>
<p><strong>主键的分类</strong></p>
<p>根据主键字段的字段数量来划分：<br>            单一主键（推荐的，常用的。）<br>            复合主键（多个字段联合起来添加一个主键约束）（复合主键不建议使用，因为违背三范式。）</p>
<p>根据主键性质来划分：<br>            自然主键：<strong>主键值最好就是一个和业务没有任何关系的自然数。</strong>（这种方式是推荐的）<br>            业务主键：主键值和系统的业务挂钩，例如：拿着银行卡的卡号做主键，拿着身份证号码作为主键。（不推荐用）最好不要拿着和业务挂钩的字段作为主键。因为以后的业务一旦发生改变的时候，主键值可能也需要随着发生变化，但有的时候没有办法变化，因为变化可能会导致主键值重复。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 建表时添加主键约束</span><br><span class="line">create table t_user(</span><br><span class="line">    id int primary key,</span><br><span class="line">    username varchar(255),</span><br><span class="line">    email varchar(255)</span><br><span class="line">);</span><br><span class="line">		</span><br><span class="line">#mysql提供主键值自增</span><br><span class="line">drop table if exists t_user;</span><br><span class="line">create table t_user(</span><br><span class="line">    id int primary key auto_increment, # id字段自动维护一个自增的数字，从1开始，以1递增。</span><br><span class="line">    username varchar(255)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="外键约束-foreign-key"><a href="#外键约束-foreign-key" class="headerlink" title="外键约束(foreign key)"></a>外键约束(foreign key)</h3><p>（简称FK）外键值可以为NULL。外键字段引用其他表的某个字段的时候，被引用的字段不一定是主键，但至少具有unique约束。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">create table t_class(</span><br><span class="line">    cno int,</span><br><span class="line">    cname varchar(255),</span><br><span class="line">    primary key(cno)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table t_student(</span><br><span class="line">    sno int,</span><br><span class="line">    sname varchar(255),</span><br><span class="line">    classno int,</span><br><span class="line">    primary key(sno),</span><br><span class="line">    foreign key(classno) references t_class(cno)</span><br><span class="line">);</span><br><span class="line"># t_student中的classno字段引用t_class表中的cno字段，此时t_class表叫做父表。t_student表叫做子表。</span><br></pre></td></tr></table></figure>
<h2 id="事务（Transaction）"><a href="#事务（Transaction）" class="headerlink" title="事务（Transaction）"></a>事务（Transaction）</h2><p>一个事务是一个完整的业务逻辑单元，不可再分。事务的存在是为了保证数据的完整性，安全性。和事务相关的语句只有：DML语句。（insert delete update）</p>
<blockquote>
<p>比如：银行账户转账，从A账户向B账户转账10000.需要执行两条update语句：<br>        update t_act set balance = balance - 10000 where actno = ‘act-001’;<br>        update t_act set balance = balance + 10000 where actno = ‘act-002’;<br>以上两条DML语句必须同时成功，或者同时失败，不允许出现一条成功，一条失败。<br>要想保证以上的两条DML语句同时成功或者同时失败，那么就需要使用数据库的“事务机制”。</p>
</blockquote>
<h3 id="事务包括四大特性：ACID"><a href="#事务包括四大特性：ACID" class="headerlink" title="事务包括四大特性：ACID"></a>事务包括四大特性：ACID</h3><blockquote>
<p>A: 原子性：事务是最小的工作单元，不可再分。<br>C: 一致性：事务必须保证多条DML语句同时成功或者同时失败。<br>I：隔离性：事务A与事务B之间具有隔离。<br>D：持久性：持久性说的是最终数据必须持久化到硬盘文件中，事务才算成功的结束。</p>
</blockquote>
<h3 id="事务隔离性存在隔离级别"><a href="#事务隔离性存在隔离级别" class="headerlink" title="事务隔离性存在隔离级别"></a>事务隔离性存在隔离级别</h3><p>理论上隔离级别包括4个</p>
<ul>
<li><p>第一级别：读未提交（read uncommitted）对方事务还没有提交，我们当前事务可以读取到对方未提交的数据。<br>读未提交存在脏读（Dirty Read）现象：表示读到了脏的数据。</p>
</li>
<li><p>第二级别：读已提交（read committed）对方事务提交之后的数据我方可以读取到。<br>解决了: 脏读。<br>存在的问题是：不可重复读。</p>
</li>
<li><p>第三级别：可重复读（repeatable read）<br>解决了：不可重复读。<br>存在的问题是：幻读，读取到的数据是幻象。</p>
</li>
<li><p>第四级别：序列化读/串行化读（serializable）<br>解决了所有问题。效率低。需要事务排队。</p>
</li>
</ul>
<blockquote>
<p>oracle 数据库默认的隔离级别是：读已提交。<br>MySQL 数据库默认的隔离级别是：可重复读。</p>
</blockquote>
<p>MySQL 事务默认情况下是自动提交，只要执行任意一条DML语句则提交一次。<br>关闭自动提交：<code>start transaction;</code>提交语句：<code>commit;</code>回滚：<code>rollback;</code></p>
<h3 id="隔离性如何实现-MVCC-多版本并发控制-和锁"><a href="#隔离性如何实现-MVCC-多版本并发控制-和锁" class="headerlink" title="隔离性如何实现:  MVCC(多版本并发控制)和锁"></a>隔离性如何实现:  MVCC(多版本并发控制)和锁</h3><p>提交读和可重复读可以通过MVCC实现，串行化可以通过锁机制实现。</p>
<h4 id="MVCC-multiple-version-concurrent-control"><a href="#MVCC-multiple-version-concurrent-control" class="headerlink" title="MVCC(multiple version concurrent control)"></a>MVCC(multiple version concurrent control)</h4><p>一种控制并发的方法，主要用来提高数据库的并发性能。在了解MVCC时应该先了解当前读和快照读：</p>
<blockquote>
<p>当前读：读取的是数据库的最新版本，并且在读取时要保证其他事务不会修改当前记录，所以会对读取的记录加锁。<br>快照读：不加锁读取操作即为快照读，使用MVCC来读取快照中的数据，避免加锁带来的性能损耗。</p>
</blockquote>
<p>MVCC的作用就是在避免加锁的情况下最大限度解决读写并发冲突的问题，它可以实现提交读和可重复度两个隔离级。不能解决丢失修改问题。<br>实现原理：</p>
<ul>
<li>版本号<ul>
<li>系统版本号：一个自增的ID，每开启一个事务，系统版本号都会递增</li>
<li>事务版本号：事务版本号就是事务开始时的系统版本号，可以通过事务版本号的大小判断事务的时间顺序。</li>
</ul>
</li>
<li>undo日志<ul>
<li>MVCC使用到的快照会存储在Undo日志中，该日志通过回滚指针将一个一个数据行的所有快照连接起来。</li>
</ul>
</li>
</ul>
<h4 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h4><ul>
<li><p>表级锁、行级锁与页面锁</p>
<blockquote>
<p>按照锁的粒度可以将MySQL锁分为三种：<br><img src="https://notes.sjtu.edu.cn/uploads/upload_706e769f8dbc49a66417d8e29879ebba.png" alt=""><br>MyISAM默认采用表级锁，InnoDB默认采用行级锁。</p>
</blockquote>
</li>
<li><p>共享锁和排他锁</p>
<blockquote>
<p>共享锁：共享锁又称读锁，简写为S锁，一个事务对一个数据对象加了S锁，可以对这个数据对象进行读取操作，但不能进行更新操作。并且在加锁期间其他事务只能对这个数据对象加S锁，不能加X锁。<br>排他锁：排他锁又称为写锁，简写为X锁，一个事务对一个数据对象加了X锁，可以对这个对象进行读取和更新操作，加锁期间，其他事务不能对该数据对象进行加X锁或S锁。</p>
</blockquote>
</li>
<li><p>乐观锁和悲观锁（逻辑上的锁）</p>
<blockquote>
<p>乐观锁：对于数据冲突保持一种乐观态度，操作数据时不会对操作的数据进行加锁，只有到数据提交的时候才通过一种机制来验证数据是否存在冲突。<br>悲观锁：对于数据冲突保持一种悲观态度，在修改数据之前把数据锁住，然后再对数据进行读写，在它释放锁之前任何人都不能对其数据进行操作，直到前面一个人把锁释放后下一个人数据加锁才可对数据进行加锁，然后才可以对数据进行操作，一般数据库本身锁的机制都是基于悲观锁的机制实现的。</p>
</blockquote>
</li>
<li><p>死锁</p>
<blockquote>
<p>如何解决数据库死锁<br>预先检测到死锁的循环依赖，并立即返回一个错误。<br>当查询的时间达到锁等待超时的设定后放弃锁请求。</p>
</blockquote>
</li>
</ul>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>索引是数据库当中的对象，使用索引可以快速访问数据表中的特定信息。</p>
<blockquote>
<p>优点：大大加快数据检索的速度，将随机I/O变成顺序I/O(因为B+树的叶子节点是连接在一起的) 加速表与表之间的连接<br>缺点：从空间角度考虑，建立索引需要占用物理空间；从时间角度考虑，创建和维护索引都需要花费时间，例如对数据进行增删改的时候都需要维护索引，有维护成本。</p>
</blockquote>
<p>添加索引是给某一个字段，或者说某些字段添加索引。<br>创建索引对象：<code>create index 索引名称 on 表名(字段名);</code><br>删除索引对象：<code>drop index 索引名称 on 表名;</code></p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li>对于中大型表建立索引非常有效，对于非常小的表，一般全部表扫描速度更快些。</li>
<li>对于超大型的表，建立和维护索引的代价也会变高，这时可以考虑分区技术。</li>
</ul>
<h3 id="设计原则（添加索引需满足什么条件）"><a href="#设计原则（添加索引需满足什么条件）" class="headerlink" title="设计原则（添加索引需满足什么条件）"></a>设计原则（添加索引需满足什么条件）</h3><ul>
<li>数据量庞大</li>
<li>该字段很少的DML操作。（因为字段进行修改操作，索引也需要维护）</li>
<li>该字段经常出现在where子句中。（经常根据哪个字段查询）</li>
</ul>
<h3 id="索引的数据结构"><a href="#索引的数据结构" class="headerlink" title="索引的数据结构"></a>索引的数据结构</h3><p>主要有B+树和哈希表。<br>InnoDB引擎的索引类型有B+树索引和哈希索引，默认为B+树索引。</p>
<ul>
<li>B+ Tree。详情：<a href="https://aoif-hikari.github.io/2021/11/25/多路查找树/">数据结构 / 多路查找树 | 心臓から花が咲くように (aoif-hikari.github.io)</a></li>
<li>哈希索引，基于哈希表实现。对于每一行数据，存储引擎会对索引列通过哈希算法进行hash得到hash code，作为哦哈希表的key值，将指向数据行的指针作为哈希表的value值。这样查找一个数据的时间复杂度就是o(1)。详情：<a href="https://aoif-hikari.github.io/2021/11/25/hash/">数据结构/Hash | 心臓から花が咲くように (aoif-hikari.github.io)</a><ul>
<li>多用于精确查找</li>
<li>不支持排序，因为哈希表是无序的。</li>
<li>不支持范围查找。</li>
<li>不支持模糊查询及多列索引的最左前缀匹配。</li>
<li>性能是不稳定，因为哈希表中存在哈希冲突。B+树索引的性能是相对稳定 的，每次查询都是从根节点到叶子节点。</li>
</ul>
</li>
</ul>
<h3 id="索引种类"><a href="#索引种类" class="headerlink" title="索引种类"></a>索引种类</h3><blockquote>
<p>主键索引：数据列不允许重复，不能为NULL，一个表只能有一个主键索引<br>组合索引：由多个列值组成的索引。<br>唯一索引：数据列不允许重复，可以为NULL，索引列的值必须唯一的，如果是组合索引，则列值的组合必须唯一。<br>全文索引：对文本的内容进行搜索。<br>普通索引：基本的索引类型，可以为NULL</p>
</blockquote>
<p>主键和具有unique约束的字段自动会添加索引。根据主键查询效率较高。尽量根据主键检索。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 模糊查询的时候，第一个通配符使用的是%，此时索引是失效的。</span><br><span class="line">select ename from emp where ename like &#x27;%A%&#x27;; # 索引失效的情况</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>聚簇索引与非聚簇索引</p>
</blockquote>
<p>最主要的区别是数据和索引是否分开存储。</p>
<ul>
<li>聚簇索引：将数据和索引放到一起存储，索引结构的叶子节点保留了数据行。</li>
<li>非聚簇索引：将数据进和索引分开存储，索引叶子节点存储的是指向数据行的地址。</li>
</ul>
<p>在InnoDB存储引擎中，默认的索引为B+树索引，利用主键创建的索引为主索引，也是聚簇索引，在主索引之上创建的索引为辅助索引，也是非聚簇索引。为什么说辅助索引是在主索引之上创建的呢，因为辅助索引中的叶子节点存储的是主键。</p>
<p>在MyISAM存储引擎中，默认的索引也是B+树索引，但主索引和辅助索引都是非聚簇索引，也就是说索引结构的叶子节点存储的都是一个指向数据行的地址。并且使用辅助索引检索无需访问主键的索引。</p>
<h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><p>建表的时候可以指定存储引擎，也可以指定字符集。mysql默认使用的存储引擎是InnoDB，默认采用的字符集是UTF8。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t_x(</span><br><span class="line">    id int(11) DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8; # 完整的建表语句</span><br></pre></td></tr></table></figure>
<ul>
<li><p>MyISAM<br>MySQL5.1及之前，MyISAM 是默认存储引擎。MyISAM不支持事务，Myisam支持表级锁，不支持行级锁，表不支持外键，该存储引擎存有表的行数，count运算会更快。适合查询频繁，不适合对于增删改要求高的情况</p>
</li>
<li><p>InnoDB<br>InnoDB 是 MySQL 的默认事务型引擎，支持事务，表是基于聚簇索引建立的。支持表级锁和行级锁，支持外键，适合数据增删改查都频繁的情况。InnoDB 采用 MVCC 来支持高并发，并且实现了四个标准的隔离级别。其默认级别是 REPEATABLE READ，并通过间隙锁策略防止幻读，间隙锁使 InnoDB 不仅仅锁定查询涉及的行，还会对索引中的间隙进行锁定防止幻行的插入。</p>
</li>
</ul>
<h2 id="数据库设计三范式"><a href="#数据库设计三范式" class="headerlink" title="数据库设计三范式"></a>数据库设计三范式</h2><ul>
<li>第一范式：任何一张表都应该有主键，并且每一个字段原子性不可再分。</li>
<li>第二范式：建立在第一范式的基础之上，所有非主键字段完全依赖主键，不能产生部分依赖。</li>
<li>第三范式：建立在第二范式的基础之上，所有非主键字段直接依赖主键，不能产生传递依赖。</li>
</ul>
<p>在实际的开发中，以满足客户的需求为主，有的时候会拿冗余换执行速度。</p>
<h2 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h2><p>窗口函数 over (partition by 用于分列的列名 order by 用于排序的列名）；<br>原则上一般写在<strong>select子句</strong>中。</p>
<p><code>over</code>用来指定函数执行的窗口范围，若后面括号中什么都不写，则意味着窗口包含满足WHERE条件的所有行，窗口函数基于所有行进行计算。如果不为空，则支持以下4中语法来设置窗口。</p>
<p>①window_name：给窗口指定一个别名。如果SQL中涉及的窗口较多，采用别名可以看起来更清晰易读；<br>②PARTITION BY 子句：窗口按照哪些字段进行分组，窗口函数在不同的分组上分别执行；<br>③ORDER BY子句：按照哪些字段进行排序，窗口函数将按照排序后的记录顺序进行编号；<br>④FRAME子句：FRAME是当前分区的一个子集，子句用来定义子集的规则，通常用来作为滑动窗口使用。</p>
<ul>
<li>解决排名问题，e.g.每个班级按成绩排名<br>序号函数：<br><code>ROW_NUMBER()</code>：顺序排序——1、2、3<br><code>RANK()</code>：并列排序，跳过重复序号——1、1、3<br><code>DENSE_RANK()</code>：并列排序，不跳过重复序号——1、1、2</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT stu_id,</span><br><span class="line">       ROW_NUMBER() OVER (PARTITION BY stu_id ORDER BY score DESC) AS score_order,       </span><br><span class="line">FROM ...</span><br><span class="line"></span><br><span class="line"># 为窗口设置别名</span><br><span class="line">SELECT ROW_NUMBER() OVER w AS rk,</span><br><span class="line">       stu_id, lesson_id, score</span><br><span class="line">FROM ...</span><br><span class="line">WHERE ...</span><br><span class="line">WINDOW w AS (PARTITION BY stu_id ORDER BY score)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>解决TOP N问题，e.g.每个班级前两名的学生</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#查询每个学生成绩最高的两个科目</span><br><span class="line">SELECT *</span><br><span class="line">FROM </span><br><span class="line">	(SELECT*,row_number() over (PARTITION BY 姓名 ORDER BY 成绩 DESC) AS ranking </span><br><span class="line">     FROM test1) </span><br><span class="line">     AS newtest</span><br><span class="line">WHERE ranking&lt;=2;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>聚合函数作为窗口函数</strong><br><strong>作用</strong>：聚合函数作为窗口函数，是起到”<strong>累加/累计</strong>“的效果，比如，就是截止到本行，最大值？最小值是多少<br><strong>与专用窗口函数的区别</strong>：括号中需要有指定列，不能为空</p>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"># 数据库</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/08/06/html%E4%B8%8Ecss/" rel="prev" title="Java / HTML与CSS">
      <i class="fa fa-chevron-left"></i> Java / HTML与CSS
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/10/09/Optical%20Flow/" rel="next" title="Optical Flow / 光流">
      Optical Flow / 光流 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">1.</span> <span class="nav-text">数据库基本操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">2.</span> <span class="nav-text">数据表基本操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.</span> <span class="nav-text">连接查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5%EF%BC%88%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="nav-number">3.1.</span> <span class="nav-text">内连接（等值连接）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="nav-number">3.2.</span> <span class="nav-text">外连接</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A6"><span class="nav-number">3.2.1.</span> <span class="nav-text">左</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%B3"><span class="nav-number">3.2.2.</span> <span class="nav-text">右</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%A8%E8%BF%9E%E6%8E%A5"><span class="nav-number">3.2.3.</span> <span class="nav-text">全连接</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A6%E6%9D%9F"><span class="nav-number">4.</span> <span class="nav-text">约束</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F-primary-key"><span class="nav-number">4.1.</span> <span class="nav-text">主键约束(primary key)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F-foreign-key"><span class="nav-number">4.2.</span> <span class="nav-text">外键约束(foreign key)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%EF%BC%88Transaction%EF%BC%89"><span class="nav-number">5.</span> <span class="nav-text">事务（Transaction）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E5%8C%85%E6%8B%AC%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7%EF%BC%9AACID"><span class="nav-number">5.1.</span> <span class="nav-text">事务包括四大特性：ACID</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E6%80%A7%E5%AD%98%E5%9C%A8%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-number">5.2.</span> <span class="nav-text">事务隔离性存在隔离级别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%94%E7%A6%BB%E6%80%A7%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0-MVCC-%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6-%E5%92%8C%E9%94%81"><span class="nav-number">5.3.</span> <span class="nav-text">隔离性如何实现:  MVCC(多版本并发控制)和锁</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MVCC-multiple-version-concurrent-control"><span class="nav-number">5.3.1.</span> <span class="nav-text">MVCC(multiple version concurrent control)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%94%81"><span class="nav-number">5.3.2.</span> <span class="nav-text">锁</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">6.</span> <span class="nav-text">索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">6.1.</span> <span class="nav-text">使用场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%EF%BC%88%E6%B7%BB%E5%8A%A0%E7%B4%A2%E5%BC%95%E9%9C%80%E6%BB%A1%E8%B6%B3%E4%BB%80%E4%B9%88%E6%9D%A1%E4%BB%B6%EF%BC%89"><span class="nav-number">6.2.</span> <span class="nav-text">设计原则（添加索引需满足什么条件）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">6.3.</span> <span class="nav-text">索引的数据结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%A7%8D%E7%B1%BB"><span class="nav-number">6.4.</span> <span class="nav-text">索引种类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-number">7.</span> <span class="nav-text">存储引擎</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E4%B8%89%E8%8C%83%E5%BC%8F"><span class="nav-number">8.</span> <span class="nav-text">数据库设计三范式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="nav-number">9.</span> <span class="nav-text">窗口函数</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="aoif.hikari"
      src="/images/cat.jpg">
  <p class="site-author-name" itemprop="name">aoif.hikari</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://www.instagram.com/fall_ivan" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;fall_ivan" rel="noopener" target="_blank"><i class="fa fa-fw fa-instagram"></i>Instagram</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-fas fa-rss"></i>RSS</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">aoif.hikari</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="Symbols count total">148k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">2:15</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"vGxmpKFQ0V9UFhbevVmCc8JP-gzGzoHsz","app_key":"ap55DtNaG0HBItnGc7CmFY5y","server_url":null,"security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'vGxmpKFQ0V9UFhbevVmCc8JP-gzGzoHsz',
      appKey     : 'ap55DtNaG0HBItnGc7CmFY5y',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body>
</html>
